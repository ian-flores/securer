% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/secure-session.R
\name{SecureSession}
\alias{SecureSession}
\title{SecureSession}
\value{
An R6 object of class \code{SecureSession}.
}
\description{
R6 class for secure code execution with tool-call IPC.

Wraps a \code{callr::r_session} with a bidirectional Unix domain socket protocol
that allows code running in the child process to pause, call tools on the
parent side, and resume with the result.
}
\examples{
\donttest{
# Basic usage
session <- SecureSession$new()
session$execute("1 + 1")
session$close()

# With tools
tools <- list(
  securer_tool("add", "Add numbers",
    fn = function(a, b) a + b,
    args = list(a = "numeric", b = "numeric"))
)
session <- SecureSession$new(tools = tools)
session$execute("add(2, 3)")
session$close()
}
\dontrun{
# With sandbox (requires platform-specific tools)
session <- SecureSession$new(sandbox = TRUE)
session$execute("1 + 1")
session$close()
}

}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-SecureSession-new}{\code{SecureSession$new()}}
\item \href{#method-SecureSession-execute}{\code{SecureSession$execute()}}
\item \href{#method-SecureSession-close}{\code{SecureSession$close()}}
\item \href{#method-SecureSession-is_alive}{\code{SecureSession$is_alive()}}
\item \href{#method-SecureSession-format}{\code{SecureSession$format()}}
\item \href{#method-SecureSession-print}{\code{SecureSession$print()}}
\item \href{#method-SecureSession-tools}{\code{SecureSession$tools()}}
\item \href{#method-SecureSession-restart}{\code{SecureSession$restart()}}
\item \href{#method-SecureSession-clone}{\code{SecureSession$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-new"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-new}{}}}
\subsection{Method \code{new()}}{
Create a new SecureSession
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$new(
  tools = list(),
  sandbox = FALSE,
  limits = NULL,
  verbose = FALSE,
  sandbox_strict = FALSE,
  audit_log = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tools}}{A list of \code{\link[=securer_tool]{securer_tool()}} objects, or a named list of
functions (legacy format for backward compatibility)}

\item{\code{sandbox}}{Logical, whether to enable the OS-level sandbox.
On macOS this uses \code{sandbox-exec} with a Seatbelt profile that
denies network access and restricts file writes to temp
directories.  On Linux this uses bubblewrap (\code{bwrap}) with full
namespace isolation.  On Windows this provides environment
isolation (clean HOME/TMPDIR, empty R_LIBS_USER) and resource
limits (memory, CPU time, process count) via Job Objects.
On other platforms the session runs without sandboxing.}

\item{\code{limits}}{An optional named list of resource limits to apply to the
child process via \code{ulimit}.  Supported names: \code{cpu} (seconds),
\code{memory} (bytes, virtual address space), \code{fsize} (bytes, max file
size), \code{nproc} (max processes), \code{nofile} (max open files),
\code{stack} (bytes, stack size).  When \code{sandbox = TRUE} and \code{limits}
is \code{NULL} (the default), sensible defaults are applied automatically
(see \code{\link[=default_limits]{default_limits()}}).  Pass \code{limits = list()} to explicitly
disable resource limits.  When \code{sandbox = FALSE}, \code{NULL} means
no limits.}

\item{\code{verbose}}{Logical, whether to emit diagnostic messages via
\code{message()}.  Useful for debugging.  Users can suppress with
\code{suppressMessages()}.}

\item{\code{sandbox_strict}}{Logical, whether to error if sandbox tools are
not available on the current platform (default \code{FALSE}).  When
\code{TRUE} and \code{sandbox = TRUE}, the session will stop with an
informative error if the OS-level sandbox cannot be set up.
When \code{FALSE} (default), the existing behavior is preserved:
a warning is emitted and the session continues without sandboxing.}

\item{\code{audit_log}}{Optional path to a JSONL file for persistent audit
logging.  If \code{NULL} (the default), no file logging is performed.
When a path is provided, structured JSON entries are appended for
session lifecycle events, executions, and tool calls.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-execute"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-execute}{}}}
\subsection{Method \code{execute()}}{
Execute R code in the secure session
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$execute(
  code,
  timeout = NULL,
  validate = TRUE,
  output_handler = NULL,
  max_tool_calls = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{code}}{Character string of R code to execute}

\item{\code{timeout}}{Timeout in seconds, or \code{NULL} for no timeout (default \code{NULL})}

\item{\code{validate}}{Logical, whether to pre-validate the code for syntax
errors before sending it to the child process (default \code{TRUE}).}

\item{\code{output_handler}}{An optional callback function that receives output
lines (character) as they arrive from the child process. If \code{NULL}
(default), output is only collected and returned as the \code{"output"}
attribute on the result.}

\item{\code{max_tool_calls}}{Maximum number of tool calls allowed in this
execution, or \code{NULL} for unlimited (default \code{NULL}).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The result of evaluating the code, with an \code{"output"} attribute
containing all captured stdout/stderr as a character vector.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-close"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-close}{}}}
\subsection{Method \code{close()}}{
Close the session and clean up resources
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$close()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Invisible self
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-is_alive"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-is_alive}{}}}
\subsection{Method \code{is_alive()}}{
Check if session is alive
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$is_alive()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Logical
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-format"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-format}{}}}
\subsection{Method \code{format()}}{
Format method for display
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$format(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{Ignored.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A character string describing the session.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-print"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-print}{}}}
\subsection{Method \code{print()}}{
Print method
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$print(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{Ignored.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible self.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-tools"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-tools}{}}}
\subsection{Method \code{tools()}}{
List registered tools and their argument specs
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$tools()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
A named list of tool information. Each element contains
\code{name} and \code{args} fields. Returns an empty list if no tools are
registered.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-restart"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-restart}{}}}
\subsection{Method \code{restart()}}{
Restart the child R process

Kills the current child process, cleans up the socket, and starts
a fresh child with the runtime and tool wrappers re-injected.
The session remains usable for subsequent \verb{$execute()} calls.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$restart()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Invisible self.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-SecureSession-clone"></a>}}
\if{latex}{\out{\hypertarget{method-SecureSession-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{SecureSession$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
