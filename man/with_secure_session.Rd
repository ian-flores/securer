% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/execute.R
\name{with_secure_session}
\alias{with_secure_session}
\title{Execute code with an auto-managed SecureSession}
\usage{
with_secure_session(fn, tools = list(), sandbox = TRUE, ...)
}
\arguments{
\item{fn}{A function that receives a \link{SecureSession} as its first argument.}

\item{tools}{List of \code{\link[=securer_tool]{securer_tool()}} objects to register in the session.}

\item{sandbox}{Logical, whether to enable OS-level sandboxing (default \code{TRUE}).}

\item{...}{Additional arguments passed to \link{SecureSession}\verb{$new()}.}
}
\value{
The return value of \code{fn(session)}.
}
\description{
Creates a \link{SecureSession}, passes it to a user function, and guarantees
cleanup via \code{\link[=on.exit]{on.exit()}}.
This is useful when you need to run multiple executions on the same session
(e.g., building up state across calls) without worrying about leaked
processes.
}
\examples{
\donttest{
# Run multiple commands on the same session
result <- with_secure_session(function(session) {
  session$execute("x <- 10", sandbox = FALSE)
  session$execute("x * 2")
}, sandbox = FALSE)

# With tools
result <- with_secure_session(
  fn = function(session) {
    session$execute("add(2, 3)")
  },
  tools = list(
    securer_tool("add", "Add two numbers",
      fn = function(a, b) a + b,
      args = list(a = "numeric", b = "numeric"))
  ),
  sandbox = FALSE
)
}

}
