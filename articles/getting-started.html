<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with securer • securer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with securer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">securer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ellmer-integration.html">Using securer with ellmer</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with securer</a></li>
    <li><a class="dropdown-item" href="../articles/security-model.html">Security Model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ian-flores/securer"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with securer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ian-flores/securer/blob/main/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>securer runs R code in a child process that is isolated by an
OS-level sandbox. Code running in the child can call named “tools” —
functions that execute on the host side, outside the sandbox.
Communication happens over a Unix domain socket using JSON messages.</p>
<p>This is designed for LLM agent systems where the model generates R
code that needs to call host-provided tools (database queries, API
calls, file operations) while being prevented from accessing the network
or writing to arbitrary filesystem locations.</p>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>The simplest way to execute code is with <code><a href="../reference/execute_r.html">execute_r()</a></code>. It
creates a session, runs the code, and tears everything down
automatically:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/securer/">securer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">"paste('Hello from', R.version.string)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Hello from R version 4.4.2 (2024-10-31)"</span></span></code></pre></div>
<p>By default <code><a href="../reference/execute_r.html">execute_r()</a></code> enables the OS sandbox
(<code>sandbox = TRUE</code>). Pass <code>sandbox = FALSE</code> to
disable it.</p>
</div>
<div class="section level2">
<h2 id="defining-tools">Defining tools<a class="anchor" aria-label="anchor" href="#defining-tools"></a>
</h2>
<p>Tools let sandboxed code call functions on the host. Define them with
<code><a href="../reference/securer_tool.html">securer_tool()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/securer/">securer</a></span><span class="op">)</span></span>
<span><span class="va">add_tool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/securer_tool.html">securer_tool</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"add"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Add two numbers"</span>,</span>
<span>  fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"numeric"</span>, b <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">add_tool</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "add"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Add two numbers"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fn</span></span>
<span><span class="co">#&gt; function (a, b) </span></span>
<span><span class="co">#&gt; a + b</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $args</span></span>
<span><span class="co">#&gt; $args$a</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $args$b</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "securer_tool"</span></span></code></pre></div>
<p>Each tool has four components:</p>
<ul>
<li>
<strong>name</strong> – the function name available to code in the
child process</li>
<li>
<strong>description</strong> – metadata (useful for LLM tool-use
prompts)</li>
<li>
<strong>fn</strong> – the implementation, which runs on the host
side (outside the sandbox)</li>
<li>
<strong>args</strong> – a named list mapping argument names to type
strings; used to generate typed wrapper functions and runtime type
checks in the child</li>
</ul>
<p>The child process receives a wrapper function
(e.g. <code>add()</code>) that serializes the call as JSON, sends it
over the Unix domain socket, blocks until the host responds, and returns
the result. From the child’s perspective it looks like a normal function
call.</p>
<div class="section level3">
<h3 id="supported-type-annotations">Supported type annotations<a class="anchor" aria-label="anchor" href="#supported-type-annotations"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Type string</th>
<th>Check function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"numeric"</code></td>
<td><code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric()</a></code></td>
</tr>
<tr class="even">
<td><code>"character"</code></td>
<td><code><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character()</a></code></td>
</tr>
<tr class="odd">
<td><code>"logical"</code></td>
<td><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">is.logical()</a></code></td>
</tr>
<tr class="even">
<td><code>"integer"</code></td>
<td><code><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer()</a></code></td>
</tr>
<tr class="odd">
<td><code>"list"</code></td>
<td><code><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list()</a></code></td>
</tr>
<tr class="even">
<td><code>"data.frame"</code></td>
<td><code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame()</a></code></td>
</tr>
</tbody>
</table>
<p>Type annotations are optional. Arguments without type annotations
skip validation.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-tools-with-execute_r">Using tools with execute_r()<a class="anchor" aria-label="anchor" href="#using-tools-with-execute_r"></a>
</h2>
<p>Pass tools as a list:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/securer_tool.html">securer_tool</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"Add two numbers"</span>,</span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"numeric"</span>, b <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/securer_tool.html">securer_tool</a></span><span class="op">(</span><span class="st">"get_weather"</span>, <span class="st">"Get weather for a city"</span>,</span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="fl">72</span>, condition <span class="op">=</span> <span class="st">"sunny"</span><span class="op">)</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>city <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">'add(2, 3)'</span>, tools <span class="op">=</span> <span class="va">tools</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">'get_weather("Boston")'</span>, tools <span class="op">=</span> <span class="va">tools</span><span class="op">)</span></span>
<span><span class="co">#&gt; $temp</span></span>
<span><span class="co">#&gt; [1] 72</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $condition</span></span>
<span><span class="co">#&gt; [1] "sunny"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="persistent-sessions-with-securesession">Persistent sessions with SecureSession<a class="anchor" aria-label="anchor" href="#persistent-sessions-with-securesession"></a>
</h2>
<p>If you need to execute multiple pieces of code, reuse a
<code>SecureSession</code> to avoid the overhead of starting a new child
process each time:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>tools <span class="op">=</span> <span class="va">tools</span>, sandbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'x &lt;- add(10, 20)'</span><span class="op">)</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'x * 2'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 60</span></span>
<span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>State persists across <code>$execute()</code> calls within the same
session. The variable <code>x</code> assigned in the first call is
available in the second.</p>
<p>Always call <code>$close()</code> when done. This terminates the
child process, removes the Unix domain socket, and cleans up any
temporary sandbox files.</p>
<div class="section level3">
<h3 id="automatic-cleanup-with-with_secure_session">Automatic cleanup with <code>with_secure_session()</code><a class="anchor" aria-label="anchor" href="#automatic-cleanup-with-with_secure_session"></a>
</h3>
<p>If you prefer not to manage <code>$close()</code> manually, use
<code><a href="../reference/with_secure_session.html">with_secure_session()</a></code>. It creates a session, passes it to
your function, and guarantees cleanup:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/with_secure_session.html">with_secure_session</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"x &lt;- 10"</span><span class="op">)</span></span>
<span>  <span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"x * 2"</span><span class="op">)</span></span>
<span><span class="op">}</span>, sandbox <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="safety-features-for-agent-workflows">Safety features for agent workflows<a class="anchor" aria-label="anchor" href="#safety-features-for-agent-workflows"></a>
</h2>
<p><code>SecureSession</code> includes several features for hardening
LLM agent deployments:</p>
<ul>
<li>
<strong><code>max_code_length</code></strong> (in
<code>$execute()</code>): Reject code strings longer than a threshold
(default 100,000 characters) before parsing.</li>
<li>
<strong><code>max_executions</code></strong> (in
<code>$new()</code>): Limit the total number of <code>$execute()</code>
calls on a session. Once reached, further calls error immediately.</li>
<li>
<strong><code>pre_execute_hook</code></strong> (in
<code>$new()</code>): A function called before every execution. Return
<code>FALSE</code> to block it. Useful for content-based filtering.</li>
<li>
<strong><code>sanitize_errors</code></strong> (in
<code>$new()</code>): Strip file paths, PIDs, and hostnames from error
messages before they reach the LLM.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  max_executions <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  pre_execute_hook <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Block code that mentions system()</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"system\\("</span>, <span class="va">code</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  sanitize_errors <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>See <code><a href="../articles/security-model.html">vignette("security-model")</a></code> for the full threat model
and defense layers.</p>
</div>
<div class="section level2">
<h2 id="sandbox">Sandbox<a class="anchor" aria-label="anchor" href="#sandbox"></a>
</h2>
<p>When <code>sandbox = TRUE</code>, the child process runs inside
platform-native OS-level restrictions.</p>
<div class="section level3">
<h3 id="macos-seatbelt">macOS (Seatbelt)<a class="anchor" aria-label="anchor" href="#macos-seatbelt"></a>
</h3>
<p>Uses <code>sandbox-exec</code> with a generated Seatbelt profile:</p>
<ul>
<li>File reads are allowed everywhere (R needs system libs and
packages)</li>
<li>File writes are blocked except to temp directories
(<code>/tmp</code>, <code>/var/folders/</code>)</li>
<li>All remote network access is blocked (TCP/UDP)</li>
<li>Unix domain sockets are allowed (needed for IPC with the host)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sandbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Computation works normally:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># Network access is blocked:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'readLines(url("http://example.com"))'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Operation not permitted</span></span>
<span></span>
<span><span class="co"># Writing outside temp is blocked:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'writeLines("test", "~/file.txt")'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Operation not permitted</span></span>
<span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="linux-bubblewrap">Linux (bubblewrap)<a class="anchor" aria-label="anchor" href="#linux-bubblewrap"></a>
</h3>
<p>Uses <code>bwrap</code> with full namespace isolation (PID, network,
user, mount, UTS, IPC). System libraries and R are bind-mounted
read-only. <code>/tmp</code> is a clean writable tmpfs. Network access
is blocked via the network namespace.</p>
<p>Requires <code>bwrap</code> to be installed. On Debian/Ubuntu:
<code>apt install bubblewrap</code>. Falls back to unsandboxed execution
with a warning if not found.</p>
</div>
<div class="section level3">
<h3 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h3>
<p>Provides environment-variable isolation only (clears
<code>R_LIBS_USER</code>, <code>R_ENVIRON_USER</code>,
<code>R_PROFILE_USER</code>; redirects
<code>HOME</code>/<code>TMPDIR</code> to a clean temp directory). No
filesystem or network restrictions. A warning is issued.</p>
</div>
</div>
<div class="section level2">
<h2 id="resource-limits">Resource limits<a class="anchor" aria-label="anchor" href="#resource-limits"></a>
</h2>
<p>Apply <code>ulimit</code>-based caps to the child process. These work
with or without the sandbox:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">"1 + 1"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cpu <span class="op">=</span> <span class="fl">10</span>, memory <span class="op">=</span> <span class="fl">256</span> <span class="op">*</span> <span class="fl">1024</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Supported limits:</p>
<table class="table">
<thead><tr class="header">
<th>Name</th>
<th>Unit</th>
<th>ulimit flag</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>cpu</code></td>
<td>seconds</td>
<td><code>-t</code></td>
<td>CPU time</td>
</tr>
<tr class="even">
<td><code>memory</code></td>
<td>bytes</td>
<td><code>-v</code></td>
<td>Virtual address space</td>
</tr>
<tr class="odd">
<td><code>fsize</code></td>
<td>bytes</td>
<td><code>-f</code></td>
<td>Maximum file size</td>
</tr>
<tr class="even">
<td><code>nproc</code></td>
<td>count</td>
<td><code>-u</code></td>
<td>Maximum processes</td>
</tr>
<tr class="odd">
<td><code>nofile</code></td>
<td>count</td>
<td><code>-n</code></td>
<td>Maximum open files</td>
</tr>
<tr class="even">
<td><code>stack</code></td>
<td>bytes</td>
<td><code>-s</code></td>
<td>Stack size</td>
</tr>
</tbody>
</table>
<p>Default limits applied when <code>sandbox = TRUE</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/default_limits.html">default_limits</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $cpu</span></span>
<span><span class="co">#&gt; [1] 60</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $memory</span></span>
<span><span class="co">#&gt; [1] 536870912</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fsize</span></span>
<span><span class="co">#&gt; [1] 52428800</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nproc</span></span>
<span><span class="co">#&gt; [1] 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nofile</span></span>
<span><span class="co">#&gt; [1] 256</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-pre-validation">Code pre-validation<a class="anchor" aria-label="anchor" href="#code-pre-validation"></a>
</h2>
<p><code><a href="../reference/validate_code.html">validate_code()</a></code> checks for syntax errors and dangerous
patterns before sending code to the child process:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Valid code</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $valid</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $warnings</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span></span>
<span><span class="co"># Syntax error</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"if (TRUE {"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $valid</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error</span></span>
<span><span class="co">#&gt; [1] "&lt;text&gt;:1:10: unexpected '{'\n1: if (TRUE {\n             ^"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $warnings</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span></span>
<span><span class="co"># Dangerous pattern (advisory warning, not a hard block)</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"system('ls')"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $valid</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $error</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $warnings</span></span>
<span><span class="co">#&gt; [1] "Code contains call to `system()` which may be restricted by the sandbox"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="execution-timeout">Execution timeout<a class="anchor" aria-label="anchor" href="#execution-timeout"></a>
</h2>
<p>Each <code>$execute()</code> call accepts a <code>timeout</code> in
seconds (default 30). If exceeded, the child is killed and the session
auto-recovers for subsequent calls:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"Sys.sleep(60)"</span>, timeout <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Execution timed out</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h2>
<p>Errors in the child process are propagated to the host:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">'stop("something went wrong")'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: something went wrong</span></span></code></pre></div>
<p>Errors in tool execution are also propagated:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_tool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/securer_tool.html">securer_tool</a></span><span class="op">(</span><span class="st">"fail"</span>, <span class="st">"Always fails"</span>,</span>
<span>  fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"tool error"</span><span class="op">)</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">'fail()'</span>, tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">bad_tool</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: tool error</span></span></code></pre></div>
<p>If a tool name is not registered, the child receives an error:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">'nonexistent_tool()'</span>, tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Unknown tool: nonexistent_tool</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a>
</h2>
<pre><code>Host process                          Child R process (sandboxed)
-----------                          ---------------------------
SecureSession$new()
  |-- callr::r_session$new()  ------&gt;  R starts inside sandbox
  |-- UDS server socket        &lt;----&gt;  UDS client connect
  |-- inject runtime code      ------&gt;  .securer_call_tool() defined
  |-- inject tool wrappers     ------&gt;  tool_name() wrappers defined

$execute("tool_name('arg')")
  |                                     eval("tool_name('arg')")
  |                                       |-- serialize as JSON
  |   &lt;---- {"tool":"tool_name",...} -----+
  |-- execute fn("arg")                   |   (child blocks)
  |-- write result JSON ---------------&gt; |
  |                                       +-- return result
  |   &lt;---- process complete -------------|
  +-- return final value</code></pre>
<p>The sandbox wrapper is injected via
<code>callr::r_session_options(arch = ...)</code> and IPC uses a Unix
domain socket in <code>/tmp</code> (to stay under the ~104 char path
limit on macOS). See <code><a href="../articles/security-model.html">vignette("security-model")</a></code> for full
details on the IPC protocol, trust boundaries, and defense layers.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Flores Siaca.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
