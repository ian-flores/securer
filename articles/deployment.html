<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Deployment and Sandboxing • securer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deployment and Sandboxing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">securer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ian-flores/securer"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deployment and Sandboxing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ian-flores/securer/blob/main/vignettes/deployment.Rmd" class="external-link"><code>vignettes/deployment.Rmd</code></a></small>
      <div class="d-none name"><code>deployment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="sandbox-overview">Sandbox overview<a class="anchor" aria-label="anchor" href="#sandbox-overview"></a>
</h2>
<p>When <code>sandbox = TRUE</code>, the child process runs inside
platform-native OS-level restrictions. The sandbox prevents
LLM-generated code from accessing the filesystem, network, or other
processes beyond what R needs to function. Each platform uses a
different mechanism, described below.</p>
</div>
<div class="section level2">
<h2 id="macos-seatbelt">macOS (Seatbelt)<a class="anchor" aria-label="anchor" href="#macos-seatbelt"></a>
</h2>
<p>Uses <code>sandbox-exec</code> with a generated Seatbelt profile:</p>
<ul>
<li>File reads are allowed everywhere (R needs system libs and
packages)</li>
<li>File writes are blocked except to temp directories
(<code>/tmp</code>, <code>/var/folders/</code>)</li>
<li>All remote network access is blocked (TCP/UDP)</li>
<li>Unix domain sockets are allowed (needed for IPC with the host)</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sandbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Computation works normally:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># Network access is blocked:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'readLines(url("http://example.com"))'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Operation not permitted</span></span>
<span></span>
<span><span class="co"># Writing outside temp is blocked:</span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">'writeLines("test", "~/file.txt")'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Operation not permitted</span></span>
<span></span>
<span><span class="va">session</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="linux-bubblewrap">Linux (bubblewrap)<a class="anchor" aria-label="anchor" href="#linux-bubblewrap"></a>
</h2>
<p>Uses <code>bwrap</code> with full namespace isolation (PID, network,
user, mount, UTS, IPC). System libraries and R are bind-mounted
read-only. <code>/tmp</code> is a clean writable tmpfs. Network access
is blocked via the network namespace.</p>
<p>Requires <code>bwrap</code> to be installed. On Debian/Ubuntu:
<code>apt install bubblewrap</code>. Falls back to unsandboxed execution
with a warning if not found.</p>
</div>
<div class="section level2">
<h2 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h2>
<p>Provides environment-variable isolation only (clears
<code>R_LIBS_USER</code>, <code>R_ENVIRON_USER</code>,
<code>R_PROFILE_USER</code>; redirects
<code>HOME</code>/<code>TMPDIR</code> to a clean temp directory). No
filesystem or network restrictions. A warning is issued.</p>
</div>
<div class="section level2">
<h2 id="resource-limits">Resource limits<a class="anchor" aria-label="anchor" href="#resource-limits"></a>
</h2>
<p>Apply <code>ulimit</code>-based caps to the child process. These work
with or without the sandbox:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/execute_r.html">execute_r</a></span><span class="op">(</span><span class="st">"1 + 1"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cpu <span class="op">=</span> <span class="fl">10</span>, memory <span class="op">=</span> <span class="fl">256</span> <span class="op">*</span> <span class="fl">1024</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Supported limits:</p>
<table class="table">
<thead><tr class="header">
<th>Name</th>
<th>Unit</th>
<th>ulimit flag</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>cpu</code></td>
<td>seconds</td>
<td><code>-t</code></td>
<td>CPU time</td>
</tr>
<tr class="even">
<td><code>memory</code></td>
<td>bytes</td>
<td><code>-v</code></td>
<td>Virtual address space</td>
</tr>
<tr class="odd">
<td><code>fsize</code></td>
<td>bytes</td>
<td><code>-f</code></td>
<td>Maximum file size</td>
</tr>
<tr class="even">
<td><code>nproc</code></td>
<td>count</td>
<td><code>-u</code></td>
<td>Maximum processes</td>
</tr>
<tr class="odd">
<td><code>nofile</code></td>
<td>count</td>
<td><code>-n</code></td>
<td>Maximum open files</td>
</tr>
<tr class="even">
<td><code>stack</code></td>
<td>bytes</td>
<td><code>-s</code></td>
<td>Stack size</td>
</tr>
</tbody>
</table>
<p>Default limits applied when <code>sandbox = TRUE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/default_limits.html">default_limits</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-pre-validation">Code pre-validation<a class="anchor" aria-label="anchor" href="#code-pre-validation"></a>
</h2>
<p><code><a href="../reference/validate_code.html">validate_code()</a></code> checks for syntax errors and dangerous
patterns before sending code to the child process:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Valid code</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Syntax error</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"if (TRUE {"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dangerous pattern (advisory warning, not a hard block)</span></span>
<span><span class="fu"><a href="../reference/validate_code.html">validate_code</a></span><span class="op">(</span><span class="st">"system('ls')"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sandbox-verification">Sandbox verification<a class="anchor" aria-label="anchor" href="#sandbox-verification"></a>
</h2>
<p>Before deploying, verify that sandbox tooling is available on your
target platform. Missing tools cause a fallback to unsandboxed execution
(or an error if <code>sandbox_strict = TRUE</code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"sysname"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Linux"</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"bwrap"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"sysname"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Darwin"</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"/usr/bin/sandbox-exec"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="strict-sandbox-mode">Strict sandbox mode<a class="anchor" aria-label="anchor" href="#strict-sandbox-mode"></a>
</h2>
<p>By default, if sandbox tools are not available on the current
platform, securer falls back to unsandboxed execution with a warning. In
production, this fallback may be unacceptable — you want a hard error
instead of silently running without protection.</p>
<p>The <code>sandbox_strict</code> parameter controls this behavior.
When <code>TRUE</code> and <code>sandbox = TRUE</code>, the session will
stop with an informative error if the OS-level sandbox cannot be set
up:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Error if sandbox not available (recommended for production)</span></span>
<span><span class="va">session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SecureSession.html">SecureSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sandbox <span class="op">=</span> <span class="cn">TRUE</span>, sandbox_strict <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>When <code>FALSE</code> (the default), the existing behavior is
preserved: a warning is emitted and the session continues without
OS-level sandboxing. Resource limits, IPC validation, and environment
sanitization still apply.</p>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a>
</h2>
<pre><code>Host process                          Child R process (sandboxed)
-----------                          ---------------------------
SecureSession$new()
  |-- callr::r_session$new()  ------&gt;  R starts inside sandbox
  |-- UDS server socket        &lt;----&gt;  UDS client connect
  |-- inject runtime code      ------&gt;  .securer_call_tool() defined
  |-- inject tool wrappers     ------&gt;  tool_name() wrappers defined

$execute("tool_name('arg')")
  |                                     eval("tool_name('arg')")
  |                                       |-- serialize as JSON
  |   &lt;---- {"tool":"tool_name",...} -----+
  |-- execute fn("arg")                   |   (child blocks)
  |-- write result JSON ---------------&gt; |
  |                                       +-- return result
  |   &lt;---- process complete -------------|
  +-- return final value</code></pre>
<p>The sandbox wrapper is injected via
<code>callr::r_session_options(arch = ...)</code> and IPC uses a Unix
domain socket in <code>/tmp</code> (to stay under the ~104 char path
limit on macOS). See <code><a href="../articles/security-model.html">vignette("security-model")</a></code> for full
details on the IPC protocol, trust boundaries, and defense layers.</p>
</div>
<div class="section level2">
<h2 id="why-not-just-callr-or-docker">Why not just callr or Docker?<a class="anchor" aria-label="anchor" href="#why-not-just-callr-or-docker"></a>
</h2>
<p><strong>callr</strong> gives you process isolation — the child runs
in a separate R process, so a crash or error does not bring down the
host. But callr provides no filesystem or network restrictions. The
child can read your SSH keys, make HTTP requests, and write anywhere on
disk.</p>
<p><strong>Docker</strong> provides full isolation (filesystem, network,
PID, user namespaces) but requires a running daemon, image management,
and container orchestration. It is heavier-weight, adds startup latency,
and does not include built-in tool-call IPC — you would need to build
your own protocol on top of stdin/stdout, HTTP, or sockets.</p>
<p><strong>securer</strong> combines OS-native sandboxing (Seatbelt on
macOS, bubblewrap on Linux) with a purpose-built tool-call IPC protocol,
resource limits, environment sanitization, execution timeouts, and audit
logging — all in a single R package with no daemon and sub-second
session startup. The sandbox is lightweight because it uses the kernel’s
own isolation primitives rather than running a full container.</p>
<table class="table">
<thead><tr class="header">
<th>Feature</th>
<th>callr</th>
<th>Docker</th>
<th>securer</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Process isolation</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Filesystem restrictions</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Network restrictions</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Tool-call IPC</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Resource limits</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Audit logging</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>No daemon required</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Sub-second startup</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Flores Siaca.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
